<!DOCTYPE html><html>
  <head>
    <title>5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf</title>
    <!--Generated by LaTeXML (version 0.7.9alpha) on 2012-06-25T23:30:52+02:00.
        See http://dlmf.nist.gov/LaTeXML/-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="start" href="Praxisbericht.html" title="">
    <link rel="prev" href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="next" href="Ch5.S6.html" title="5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="stylesheet" type="text/css" href="core.css">
    <link rel="stylesheet" type="text/css" href="navbar-left.css">
  </head>
  <body>
    <nav class="navbar"><a href="Praxisbericht.html" title="" class="ref start">?</a>
    
  <ul class="toc">
  <li class="tocentry">
<a href="Praxisbericht.html" title="" class="ref toc">?</a>
  <ul class="toc">
  <li class="tocentry"><a href="Ch1.html" title="Chapter 1 Hinweise zum Dokument" class="ref toc"><span class="text reftitle"><span class="tag">1 </span>Hinweise zum Dokument</span></a></li>
  <li class="tocentry"><a href="Ch2.html" title="Chapter 2 Einleitung" class="ref toc"><span class="text reftitle"><span class="tag">2 </span>Einleitung</span></a></li>
  <li class="tocentry"><a href="Ch3.html" title="Chapter 3 Vorstellung der vorhandenen Hardware" class="ref toc"><span class="text reftitle"><span class="tag">3 </span>Vorstellung der vorhandenen Hardware</span></a></li>
  <li class="tocentry"><a href="Ch4.html" title="Chapter 4 Vorstellung der vorhandenen Software" class="ref toc"><span class="text reftitle"><span class="tag">4 </span>Vorstellung der vorhandenen Software</span></a></li>
  <li class="tocentry">
<a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a>
  <ul class="toc">
  <li class="tocentry"><a href="Ch5.S1.html" title="5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1 </span>Bereitstellen grundlegender Funktionalitäten</span></a></li>
  <li class="tocentry"><a href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.2 </span>Befehlssätze</span></a></li>
  <li class="tocentry"><a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.3 </span>Kommunikation mit der vorhandenen Schrittmotorsteuerung</span></a></li>
  <li class="tocentry"><a href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.4 </span>Verbesserungen an der vorhandenen Hardware</span></a></li>
  <li class="tocentry self">
<span class="ref toc here"><span class="text reftitle"><span class="tag">5.5 </span>Kommunikation mit RapidForm2004</span></span>
  <ul class="toc">
  <li class="tocentry">
<a href="#SS1" title="5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.5.1 </span>Befehle empfangen</span></a>
  <ul class="toc">
  <li class="tocentry"><a href="#SS1.SSS1" title="5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.5.1.1 </span>Automatische Auswahl eines Befehlssatzes</span></a></li>
    </ul>
</li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch5.S6.html" title="5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6 </span>Auswerte-Funktionen</span></a></li>
  <li class="tocentry"><a href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.7 </span>Platinenlayout und 19”-Einschub</span></a></li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch6.html" title="Chapter 6 Probleme und Lösungen" class="ref toc"><span class="text reftitle"><span class="tag">6 </span>Probleme und Lösungen</span></a></li>
  <li class="tocentry"><a href="Ch7.html" title="Chapter 7 Fazit und weitere Möglichkeiten" class="ref toc"><span class="text reftitle"><span class="tag">7 </span>Fazit und weitere Möglichkeiten</span></a></li>
  <li class="tocentry"><a href="bib.html" title="Bibliography" class="ref toc"><span class="text reftitle">Bibliography</span></a></li>
  <li class="tocentry"><a href="idx.html" title="Index" class="ref toc"><span class="text reftitle">Index</span></a></li>
    </ul>
</li>
    </ul>
      </nav>
    <div class="main">
    <header class="header"><a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref up"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a><a href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5.4 </span>Verbesserungen an der vorhandenen Hardware</span></a><a href="Ch5.S6.html" title="5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.6 </span>Auswerte-Funktionen</span></a>
      </header>
    <div class="content">
<section class="section"><hgroup><h1 class="title">
<span class="tag">5.5 </span>Kommunikation mit RapidForm2004</h1></hgroup><div id="p1" class="para"><p class="p">RapidForm2004 sendet Befehle die für die Drehtischsteuerung bestimmt sind an den Mikrocontroller. Diese sollen dort empfangen, ausgewertet und in verständlicher Form an die Drehtischsteuerung weiter gegeben werden. RapidForm2004 verwendet dabei verschiedene Befehlssätze für verschiedene Schrittmotorsteuerungen. Für jeden dieser Befehlssätze wird eine eigene Auswerte-Funktion geschrieben. Im folgenden Kapitel wird nun das Empfangen der Befehle beschrieben und eine erste Auswertung, die den empfangenen Befehl dem Befehlssatz einer Schrittmotorsteuerung zuordnet.
Nachdem ein Befehl zugeordnet wurde und in der entsprechenden Auswerte-Funktion erkannt wurde, soll ein entsprechender Befehl an die Drehtischsteuerung gesendet und die Antwort der Drehtischsteuerung vom Mikrocontroller ausgewertet werden. Abschließend soll eine entsprechende Antwort an RapidForm2004 zurück gesendet werden. Abbildung <a href="#Ch5.F5" title="Figure 5.5 ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.5</span></a> zeigt eine schematische Übersicht dieser Kommunikation.<br class="break">Die Kommunikation mit RapidForm2004 ist ähnlich zu der mit der Schrittmotorsteuerung. Diese wurde bereits in Kapitel <a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3</span></a> ausführlich beschrieben. Daher wird die Kommunikation hier etwas oberflächlicher behandelt.</p></div>
<figure id="Ch5.F5" class="figure"><img src="" id="Ch5.F5.g1" class="graphics centering"><figcaption class="caption centering"><span class="tag">Figure 5.5: </span>Schema der Kommunikation</figcaption></figure><section id="SS1" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.5.1 </span>Befehle empfangen</h1></hgroup><div id="SS1.p1" class="para"><p class="p">Zuerst sollen nun die Befehle von RapidForm2004 an den Mikrocontroller, gespeichert werden. Anschließend wird die automatische Auswahl des Befehlssatzes beschrieben.<br class="break">Um anstehende Befehle zu empfangen wird, ähnlich wie in Kapitel <a href="Ch5.S3.html#SS2" title="5.3.2 Antworten empfangen und speichern ‣ 5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3.2</span></a>, eine Funktion die ständig das Eingangsregister der ersten seriellen Schnittstelle abfragt verwendet (siehe Codelisting <a href="#LST11" title="11 ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">11</span></a>). Auch hier wird die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">uart_rx(dir)</span> aufgerufen, jedoch mit dem Parameter <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">D_RapidForm</span>. Der empfangenen String wird auch hier in die Variable <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">str_rx</span> gespeichert. Somit können nun auch Strings von RapidForm2004 empfangen und in der Variablen <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">str_rx</span> gespeichert werden.</p></div>
<figure id="LST11" class="listing language_Java"><figcaption class="caption"><span class="tag">Listing 11: </span>RS-232 Empfang - RapidForm2004</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>((UCSR0A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC0))){<span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">RapidForm<span class="text lstspace"> </span>Polling</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>LED_PORT<span class="text lstspace"> </span>&amp;=<span class="text lstspace"> </span>(<span class="text lstspace"> </span>1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>LED2<span class="text lstspace"> </span>);<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">LED<span class="text lstspace"> </span>einschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_rx(D_RapidForm);<span class="text lstspace">             </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Register<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
</table></figure><section id="SS1.SSS1" class="subsubsection"><hgroup><h1 class="title">
<span class="tag">5.5.1.1 </span>Automatische Auswahl eines Befehlssatzes</h1></hgroup><div id="SS1.SSS1.p1" class="para"><p class="p">Nun geht es darum, dass der Mikrocontroller anhand eines ersten Befehls der empfangen wird, festlegt, mit welchem Befehlssatz fortan kommuniziert werden soll. Die Kennung für den Befehlssatz wird in einer globalen Variable gespeichert und alle weiteren Befehle werden an die entsprechende Auswerte-Funktion für diesen Befehlssatz übergeben.<br class="break">In der Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">uart_rx(dir)</span>(Codelisting <a href="#LST12" title="12 ‣ 5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">12</span></a>) wird nun in der ersten <em class="emph">if-Abfrage</em> entschieden, von welcher Schnittstelle der empfangene Befehl kam. Diese verzweigt nun, da <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">D_RapidForm</span> übergeben wurde, in den else-Teil. In diesem wird mit mehreren <em class="emph">if-Abfragen</em> überprüft, ob bereits der Befehlssatz für einen bestimmten Motor ausgewählt wurde. Ist dies nicht der Fall, wird der empfangende String an die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">switch_Motor(str_rx)</span>(Codelisting <a href="#LST13" title="13 ‣ 5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">13</span></a>) übergeben. Diese prüfte mit der aus Kapitel <a href="Ch5.S3.html#SS3" title="5.3.3 Antworten auswerten ‣ 5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3.3</span></a> bekannten Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">FindStringInArray(str_rx, pOptions, 3)</span>, den angekommenen String gegen die Initialisierungsbefehle der einzelnen Befehlssätze. Die Initialisierungsbefehle sind die ersten Befehle die RapidForm2004 an eine Schrittmotorsteuerung sendet um zu prüfen ob diese vorhanden ist. In diesem ersten Schritt wird der String nur zur Identifizierung des von RapidForm2004 verwendeten Befehlssatzes verwendet. Das Antworten auf einen String wird erst in den nachfolgenden Kapiteln beschrieben. Die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">switch_Motor(str_rx)</span> gibt einen numerischen Wert zurück. Jede Zahl entspricht dabei dem Befehlssatz für eine Schrittmotorsteuerung. Die Zahlenwerte werden dabei mittels Makro-Definitionen (Codelisting <a href="#LST13" title="13 ‣ 5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">13</span></a> Zeile 1-6) durch lesbare Text-Variablen ersetzt. Dies erhöhte die Lesbarkeit und das Verständnis. War dieser Schritt erfolgreich, wird in den folgenden if-Abfragen die richtige Auswerte-Funktion aufgerufen. Konnte die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">switch_Motor(str_rx)</span> den empfangen Befehl nicht zuordnen, gibt sie <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">M_UNK</span> zurück und es wird auf dem Display <em class="emph">Unbekannter Motor!</em> ausgegeben.<br class="break">Somit ist es möglich Befehle von RapidForm2004 zu empfangen und an die richtige Auswerte-Funktionen zu übergeben. Zusätzlich wird die Programmierung dadurch wesentlich robuster, da unbekannte Befehle ignoriert werden.<br class="break">Der Nachteil dieses Vorgehens besteht darin, dass für ein wechseln des Befehlssatzes der Mikrocontroller neu gestartet werden muss. Ein Beheben dieses Nachteils wäre nicht ohne weiteres möglich gewesen.</p></div>
<figure id="LST12" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 12: </span>Funktion: uart rx()</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>Empfangsregister<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>uart_rx<span class="text lstspace">                                </span>(<span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>dir)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_get_string(str_rx,<span class="text lstspace"> </span>dir);<span class="text lstspace">   </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>aus<span class="text lstspace"> </span>Empfangsregister<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(dir<span class="text lstspace"> </span>==<span class="text lstspace"> </span>D_Stepper)<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Empfangsregister<span class="text lstspace"> </span>Stepper</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>switch_Stepper(str_rx);<span class="text lstspace">             </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersung<span class="text lstspace"> </span>Stepper</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span>{<span class="text lstspace">                               </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Empfangsregsiter<span class="text lstspace"> </span>RapidForm</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzungsfunktion<span class="text lstspace"> </span>auswaehlen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_UNK){<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Unbekannter<span class="text lstspace"> </span>Initialisierungsbefehl</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_puts(”<span class="text" style="color:#000000;">Unbekannter<span class="text lstspace"> </span>Motor!\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>Initialized<span class="text lstspace"> </span>=<span class="text lstspace"> </span>M_NOTI;<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Variable<span class="text lstspace"> </span>Initialized<span class="text lstspace"> </span>zuruecksetzen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_NOTI){<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Befehlssatz<span class="text lstspace"> </span>bestimmen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>Initialized<span class="text lstspace"> </span>=<span class="text lstspace"> </span>switch_Motor(str_rx);<span class="text lstspace"> </span>//<span class="text" style="color:#008000;">Automatische<span class="text lstspace"> </span>Befehlssatzwahl</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_ISEL)<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzung<span class="text lstspace"> </span>ISEL</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>switch_Isel(str_rx);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_CSG)<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzung<span class="text lstspace"> </span>CSG</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>switch_csg(str_rx);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_ZETA)<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzung<span class="text lstspace"> </span>Zeta</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>switch_Zeta(str_rx);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(Initialized<span class="text lstspace"> </span>==<span class="text lstspace"> </span>M_TERMINAL)<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzung<span class="text lstspace"> </span>Terminal</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">22</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>switch_Terminal(str_rx);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">23</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">24</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
</table></figure><figure id="LST13" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 13: </span>Funktion: switch Motor()</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_UNK<span class="text lstspace">           </span>-2</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_NOTI<span class="text lstspace">              </span>-1</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_ISEL<span class="text lstspace">           </span>0</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_CSG<span class="text lstspace">               </span>1</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_ZETA<span class="text lstspace">           </span>2</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>M_TERMINAL<span class="text lstspace">       </span>3</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace">        </span>Initialized<span class="text lstspace"> </span>=<span class="text lstspace"> </span>M_NOTI;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Automatische<span class="text lstspace"> </span>Befehlssatzwahl</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace">        </span>switch_Motor<span class="text lstspace">                </span>(<span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>str_rx)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">const</span><span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">char</span>*<span class="text lstspace"> </span>pOptions[]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>{<span class="text lstspace">       </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Array<span class="text lstspace"> </span>mit<span class="text lstspace"> </span>Initialisierungsbefehlen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">@01</span>”,<span class="text lstspace">          </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">0<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Isel</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">Q:</span>”,<span class="text lstspace">           </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">1<span class="text lstspace"> </span>-<span class="text lstspace"> </span>CSG</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">ECHO0</span>”,<span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">2<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Zeta</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">!Terminal</span>”,<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">3<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Terminal<span class="text lstspace"> </span>ansteuerung!</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>0<span class="text lstspace"> </span>};</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Ankommenden<span class="text lstspace"> </span>String<span class="text lstspace"> </span>gegen<span class="text lstspace"> </span>Array<span class="text lstspace"> </span>pruefen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">switch</span><span class="text lstspace"> </span>(FindStringInArray(str_rx,<span class="text lstspace"> </span>pOptions,<span class="text lstspace"> </span>3))<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>0:<span class="text lstspace">             </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">0<span class="text lstspace"> </span>-<span class="text lstspace"> </span>ISEL</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>M_ISEL;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>1:<span class="text lstspace">             </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">1<span class="text lstspace"> </span>-<span class="text lstspace"> </span>CSG</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">22</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>M_CSG;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">23</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">24</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>2:<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">2<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Zeta</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">25</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>M_ZETA;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">26</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">27</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>3:<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">3<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Terminal<span class="text lstspace"> </span>ansteuerung</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">28</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>M_TERMINAL;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">29</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">30</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">default</span>:</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">31</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>M_UNK;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">32</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">33</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
</table></figure></section></section></section>
        </div>
    <footer class="footer">June 25, 2012<a href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5.4 </span>Verbesserungen an der vorhandenen Hardware</span></a><a href="Ch5.S6.html" title="5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.6 </span>Auswerte-Funktionen</span></a>
      </footer>
      </div>
    </body>
</html>
