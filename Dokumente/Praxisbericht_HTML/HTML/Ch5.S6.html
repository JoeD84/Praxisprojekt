<!DOCTYPE html><html>
  <head>
    <title>5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf</title>
    <!--Generated by LaTeXML (version 0.7.9alpha) on 2012-06-25T23:30:52+02:00.
        See http://dlmf.nist.gov/LaTeXML/-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="start" href="Praxisbericht.html" title="">
    <link rel="prev" href="Ch5.S5.html" title="5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="next" href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="stylesheet" type="text/css" href="core.css">
    <link rel="stylesheet" type="text/css" href="navbar-left.css">
  </head>
  <body>
    <nav class="navbar"><a href="Praxisbericht.html" title="" class="ref start">?</a>
    
  <ul class="toc">
  <li class="tocentry">
<a href="Praxisbericht.html" title="" class="ref toc">?</a>
  <ul class="toc">
  <li class="tocentry"><a href="Ch1.html" title="Chapter 1 Hinweise zum Dokument" class="ref toc"><span class="text reftitle"><span class="tag">1 </span>Hinweise zum Dokument</span></a></li>
  <li class="tocentry"><a href="Ch2.html" title="Chapter 2 Einleitung" class="ref toc"><span class="text reftitle"><span class="tag">2 </span>Einleitung</span></a></li>
  <li class="tocentry"><a href="Ch3.html" title="Chapter 3 Vorstellung der vorhandenen Hardware" class="ref toc"><span class="text reftitle"><span class="tag">3 </span>Vorstellung der vorhandenen Hardware</span></a></li>
  <li class="tocentry"><a href="Ch4.html" title="Chapter 4 Vorstellung der vorhandenen Software" class="ref toc"><span class="text reftitle"><span class="tag">4 </span>Vorstellung der vorhandenen Software</span></a></li>
  <li class="tocentry">
<a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a>
  <ul class="toc">
  <li class="tocentry"><a href="Ch5.S1.html" title="5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1 </span>Bereitstellen grundlegender Funktionalitäten</span></a></li>
  <li class="tocentry"><a href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.2 </span>Befehlssätze</span></a></li>
  <li class="tocentry"><a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.3 </span>Kommunikation mit der vorhandenen Schrittmotorsteuerung</span></a></li>
  <li class="tocentry"><a href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.4 </span>Verbesserungen an der vorhandenen Hardware</span></a></li>
  <li class="tocentry"><a href="Ch5.S5.html" title="5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.5 </span>Kommunikation mit RapidForm2004</span></a></li>
  <li class="tocentry self">
<span class="ref toc here"><span class="text reftitle"><span class="tag">5.6 </span>Auswerte-Funktionen</span></span>
  <ul class="toc">
  <li class="tocentry">
<a href="#SS1" title="5.6.1 Auswerte-Funktion für Isel-Motoren ‣ 5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6.1 </span>Auswerte-Funktion für Isel-Motoren</span></a>
  <ul class="toc">
  <li class="tocentry"><a href="#SS1.SSS1" title="5.6.1.1 Initialisierung ‣ 5.6.1 Auswerte-Funktion für Isel-Motoren ‣ 5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6.1.1 </span>Initialisierung</span></a></li>
  <li class="tocentry"><a href="#SS1.SSS2" title="5.6.1.2 Statusabfrage ‣ 5.6.1 Auswerte-Funktion für Isel-Motoren ‣ 5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6.1.2 </span>Statusabfrage</span></a></li>
  <li class="tocentry"><a href="#SS1.SSS3" title="5.6.1.3 Rotation ‣ 5.6.1 Auswerte-Funktion für Isel-Motoren ‣ 5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6.1.3 </span>Rotation</span></a></li>
    </ul>
</li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.7 </span>Platinenlayout und 19”-Einschub</span></a></li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch6.html" title="Chapter 6 Probleme und Lösungen" class="ref toc"><span class="text reftitle"><span class="tag">6 </span>Probleme und Lösungen</span></a></li>
  <li class="tocentry"><a href="Ch7.html" title="Chapter 7 Fazit und weitere Möglichkeiten" class="ref toc"><span class="text reftitle"><span class="tag">7 </span>Fazit und weitere Möglichkeiten</span></a></li>
  <li class="tocentry"><a href="bib.html" title="Bibliography" class="ref toc"><span class="text reftitle">Bibliography</span></a></li>
  <li class="tocentry"><a href="idx.html" title="Index" class="ref toc"><span class="text reftitle">Index</span></a></li>
    </ul>
</li>
    </ul>
      </nav>
    <div class="main">
    <header class="header"><a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref up"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a><a href="Ch5.S5.html" title="5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5.5 </span>Kommunikation mit RapidForm2004</span></a><a href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.7 </span>Platinenlayout und 19”-Einschub</span></a>
      </header>
    <div class="content">
<section class="section"><hgroup><h1 class="title">
<span class="tag">5.6 </span>Auswerte-Funktionen</h1></hgroup><div id="p1" class="para"><p class="p">Die Auswerte-Funktionen sind das Herzstück des Programms. Es geht darum für jedes Protokoll eine eigene Auswerte-Funktion zu schreiben. Diese sollen die von RapidForm2004 kommenden Strings verstehen können und in einen, für die vorhandene Schrittmotorkarte, verständlichen Befehl übersetzen können. Die Funktionen sollen weiterhin prüfen, ob der Befehl von der Schrittmotorkarte erkannt wurde und den Status der Schrittmotorkarte zurück an RapidForm2004 melden.<br class="break">Alle bisherigen Arbeitsschritte hatten zum Ziel, die Kommunikation zwischen RapidForm2004 und der ersten Schrittmotorkarte zu ermöglichen. Nun fehlt nur noch der Teil des Programms der die ankommenden Befehle auswertet und in verständlicher Form an die Schrittmotorkarte weitergibt.
Im folgenden Kapitel wird dieser Ablauf nun exemplarisch für den Befehlssatz eines Isel-Motors erklärt.</p></div>
<section id="SS1" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.6.1 </span>Auswerte-Funktion für Isel-Motoren</h1></hgroup><div id="SS1.p1" class="para"><p class="p">Wird der Befehl <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">@01</span> empfangen, übergibt die in Kapitel <a href="Ch5.S5.html#SS1.SSS1" title="5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.5.1.1</span></a> beschriebene Funktion, den String an die Auswerte-Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">switch_Isel(str_rx)</span>. Der Ablauf dieser Funktion ist ähnlich aufgebaut wie bei der Kommunikation mit der Schrittmotorkarte (Kapitel <a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3</span></a>) und bei der automatischen Auswahl des Befehlssatzes (Kapitel <a href="Ch5.S5.html#SS1.SSS1" title="5.5.1.1 Automatische Auswahl eines Befehlssatzes ‣ 5.5.1 Befehle empfangen ‣ 5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.5.1.1</span></a>. In der Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">switch_Isel(str_rx)</span> sind in dem Array <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">pOptions</span> alle benötigten Befehle des Isel-Befehlssatzes hinterlegt. Mit der aus Kapitel <a href="Ch5.S3.html#SS3" title="5.3.3 Antworten auswerten ‣ 5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3.3</span></a> bekannten Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">FindStringInArray(str_rx, pOptions)</span> wird  <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">str_rx</span> gegen diese Befehle geprüft. Wird der Befehl im Array gefunden gibt die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">FindStringInArray()</span> die Position des Strings im Array zurück. Mittels einer <span class="text" style="background-color:#D9D9FF;">switch-case-Struktur</span> lässt sich nun so für jeden Befehl ein entsprechender Ablauf ausführen. Die einzelnen Abläufe werden übersichtlich in den folgenden Kapiteln beschrieben.</p></div>
<figure id="LST14" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 14: </span>Übersetzungs Logik für einen Isel-Motor</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Uebersetzung<span class="text lstspace"> </span>Isel</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>switch_Isel<span class="text lstspace">                        </span>(<span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>str_rx)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">const</span><span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">char</span>*<span class="text lstspace"> </span>pOptions[]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">XXXXXXX</span>”,<span class="text lstspace">      </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">0<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Reserve</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">!CLS</span>”,<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">1<span class="text lstspace"> </span>-<span class="text lstspace"> </span>LC-Display<span class="text lstspace"> </span>loeschen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">Test</span>”,<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">2<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Test</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">@01</span>”,<span class="text lstspace">          </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">3<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Achse<span class="text lstspace"> </span>auswaehlen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">@0R</span>”,<span class="text lstspace">          </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">4<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Status<span class="text lstspace"> </span>abfrage</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>”<span class="text" style="color:#000000;">@0M</span>”,<span class="text lstspace">          </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">5<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Gehe<span class="text lstspace"> </span>zu<span class="text lstspace"> </span>Position</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>0<span class="text lstspace"> </span>};</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">switch</span><span class="text lstspace"> </span>(FindStringInArray(str_rx,<span class="text lstspace"> </span>pOptions,<span class="text lstspace"> </span>3))</span></td>
</tr>
</table></figure><section id="SS1.SSS1" class="subsubsection"><hgroup><h1 class="title">
<span class="tag">5.6.1.1 </span>Initialisierung</h1></hgroup><div id="SS1.SSS1.p1" class="para"><p class="p">Für den String <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">@01</span> wird <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">case 3</span> ausgeführt. Dieser Codeblock zeigt die Meldung <em class="emph">Init</em> auf dem Display an und sendet den erwarteten Befehl an RapidForm2004.
</p></div>
<figure id="LST15" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 15: </span>case 3: Initialisierung</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>3:<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">3<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Achse<span class="text lstspace"> </span>auswaehlen<span class="text lstspace"> </span>(Initialisierung)</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ms_spin(10);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(”<span class="text" style="color:#000000;">Init</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_put_string(”<span class="text" style="color:#000000;">0\r\n</span>”,<span class="text lstspace"> </span>D_RapidForm);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
</table></figure></section><section id="SS1.SSS2" class="subsubsection"><hgroup><h1 class="title">
<span class="tag">5.6.1.2 </span>Statusabfrage</h1></hgroup><div id="SS1.SSS2.p1" class="para"><p class="p">Wird der String <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">@0R</span> empfangen, wird der Codeblock <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">case 4</span> ausgeführt. Auf dem LC-Display wird <em class="emph">Satusabfrage:</em> ausgegeben. Danach wird der entsprechende Befehl für eine Statusabfrage an die Schrittmotorkarte gesendet. Nach einer kurzen Pause von 50ms, um die Verarbeitung auf der Schrittmotorkarte zu gewährleisten, wird mit einer if-Anweisung geprüft ob sich Daten im Schrittmotorkarten-Empfangsregister befinden. Sprich, die Schrittmotorkarte reagiert hat. Ist dies der Fall, wird der Ablauf, bekannt aus Kapitel <a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">5.3</span></a>, durchlaufen. Während diesem Ablauf wird die entsprechende Antwort der Schrittmotorkarte auf dem LC-Display ausgegeben. In einer weiteren if-Anweisung wird überprüft ob der angekommene String erfolgreich war. Wenn ja, wird dies an RapidForm2004 gemeldet. Andernfalls zeigt das Display <em class="emph">Fehlgeschlagen</em> an und sendet eine <em class="emph">1</em> an RapidForm2004.</p></div>
<figure id="LST16" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 16: </span>case 4: Statusabfrage</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>4:<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">4<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Status<span class="text lstspace"> </span>abfrage</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(”<span class="text" style="color:#000000;">Statusabfrage:<span class="text lstspace">     </span>\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_put_string(”<span class="text" style="color:#000000;">A\n</span>”,<span class="text lstspace"> </span>D_Stepper);<span class="text lstspace">      </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Statusabfrage<span class="text lstspace"> </span>an<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>senden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ms_spin(50);<span class="text lstspace">                                   </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Verarbeitungszeit<span class="text lstspace"> </span>gewaehren</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>((UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC1)))<span class="text lstspace">                 </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Wenn<span class="text lstspace"> </span>ein<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>empfangen<span class="text lstspace"> </span>wurde</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_rx(D_Stepper);<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zeichen<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(!strcmp(str_rx,”<span class="text" style="color:#000000;">0#</span>”))<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Empfangenes<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>ueberpruefen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_put_string(”<span class="text" style="color:#000000;">0\r\n</span>”,<span class="text lstspace"> </span>D_RapidForm);<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Antwort<span class="text lstspace"> </span>Ok<span class="text lstspace"> </span>an<span class="text lstspace"> </span>RF<span class="text lstspace"> </span>melden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text" style="color:#000000;">Fehlgeschlagen<span class="text lstspace">     </span>\n</span>”);<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Fehler<span class="text lstspace"> </span>auf<span class="text lstspace"> </span>Display<span class="text lstspace"> </span>anzeigen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_put_string(”<span class="text" style="color:#000000;">1\r\n</span>”,<span class="text lstspace"> </span>D_RapidForm);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Fehler<span class="text lstspace"> </span>an<span class="text lstspace"> </span>RapidForm<span class="text lstspace"> </span>melden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
</table></figure></section><section id="SS1.SSS3" class="subsubsection"><hgroup><h1 class="title">
<span class="tag">5.6.1.3 </span>Rotation</h1></hgroup><div id="SS1.SSS3.p1" class="para"><p class="p">Der Codeblock von <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">case 5</span> ist für die Rotation verantwortlich. Es werden je ein String für die Endposition und für den Winkel mit Stringterminierungszeichen vorbelegt. Diese werden an die Funktion <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">String_zerlegen_Isel(str_rx, Position, Winkel)</span> (Codelisting <a href="#LST18" title="18 ‣ 5.6.1.3 Rotation ‣ 5.6.1 Auswerte-Funktion für Isel-Motoren ‣ 5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">18</span></a>) übergeben. Dort wird der String in die Bestandteile <em class="emph">Achse</em>, <em class="emph">Rotationsbefehl</em>, <em class="emph">Position/Anzahl der Schritte</em> und <em class="emph">Geschwindigkeit</em> zerlegt. Von diesen ist nur die Anzahl der Schritte relevant. Da die Anzahl der Schritte für den Schrittmotor angepasst werden muss, wird der String in eine Zahl umgewandelt und mit einem entsprechenden Faktor multipliziert. Zugunsten der Rechenzeit wird nicht exakt gerechnet und die Division im Faktor mit 1024 durchgeführt. Diese wird beim Kompilieren durch eine <span class="text" style="background-color:#D9D9FF;">Bitverschiebung</span> ersetzt. Dies spart mehrere Sekunden Rechenzeit und die Abweichung der Schritte beträgt nur maximal 3 Schritte. Die berechnete Anzahl der Schritte wird anschließend wieder als String gespeichert. Dieser wird dann an den String für den Rotationsbefehl der Schrittmotorkarte angehängt. Der neue String wird auf dem Display ausgegeben und an die Schrittmotorsteuerung gesendet. Die Antwort der Schrittmotorsteuerung wird ausgelesen und anschließend wird in einer <span class="text" style="background-color:#D9D9FF;">while-Schleife</span> so lange der Status des Motors abgefragt bis dieser keine Bewegung mehr meldet. Die Position ist damit erreicht und es wird der erwartete Befehl an RapidForm2004 gesendet.</p></div>
<figure id="LST17" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 17: </span>case 5: Rotation</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">case</span><span class="text lstspace"> </span>5:<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">5<span class="text lstspace"> </span>-<span class="text lstspace"> </span>Gehe<span class="text lstspace"> </span>zu<span class="text lstspace"> </span>Position<span class="text lstspace"> </span>MX<span class="text lstspace"> </span>,<span class="text lstspace"> </span>+600</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ms_spin(10);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>Position[33],<span class="text lstspace"> </span>Winkel[6];</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>memset(Position,<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’,<span class="text lstspace"> </span>33);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Strign<span class="text lstspace"> </span>0<span class="text lstspace"> </span>Terminiert<span class="text lstspace"> </span>vorbelegen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>memset(Winkel,<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’,<span class="text lstspace"> </span>6);<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>0<span class="text lstspace"> </span>Terminiert<span class="text lstspace"> </span>vorbelegen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>String_zerlegen_Isel(str_rx,<span class="text lstspace"> </span>Position,<span class="text lstspace"> </span>Winkel);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>auswerten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>fuer<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>vorbereiten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>Move_To[40];</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>memset(Move_To,<span class="text lstspace">  </span>’<span class="text" style="color:#000000;">\0</span>’,<span class="text lstspace"> </span>40);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Move_To[0]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">M</span>’;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Move_To[1]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">A</span>’;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Move_To[2]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text lstspace" style="color:#000000;"> </span>’;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Move_To[3]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>strcat(Move_To,<span class="text lstspace"> </span>Position);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>strcat(Move_To,<span class="text lstspace"> </span>”<span class="text" style="color:#000000;">\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(”<span class="text" style="color:#000000;">Pos:</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(Move_To);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>an<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>senden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_put_string(Move_To,<span class="text lstspace"> </span>D_Stepper);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ms_spin(50);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>((UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC1)))</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">22</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_rx(D_Stepper);<span class="text lstspace">     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Antwort<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">23</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">24</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Bei<span class="text lstspace"> </span>Fehler<span class="text lstspace"> </span>abbrechen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">25</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">26</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Status<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>Abfragen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">27</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_put_string(”<span class="text" style="color:#000000;">A\n</span>”,<span class="text lstspace"> </span>D_Stepper);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">28</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ms_spin(50);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">29</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Antwort<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>Abfragen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">30</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>((UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC1)))</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">31</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_rx(D_Stepper);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">32</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">33</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text" style="color:#000000;">Keine<span class="text lstspace"> </span>Bewegung!\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">34</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">35</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">So<span class="text lstspace"> </span>lange<span class="text lstspace"> </span>der<span class="text lstspace"> </span>Stepper<span class="text lstspace"> </span>Bewegung<span class="text lstspace"> </span>meldet<span class="text lstspace"> </span>erneut<span class="text lstspace"> </span>Statusabfrage</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">36</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(!strcmp(str_rx,”<span class="text" style="color:#000000;">1#</span>”)){</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">37</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Statusabfrage<span class="text lstspace"> </span>an<span class="text lstspace"> </span>Stepper</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">38</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_put_string(”<span class="text" style="color:#000000;">A\n</span>”,<span class="text lstspace"> </span>D_Stepper);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">39</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>ms_spin(50);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">40</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Statusabfrage<span class="text lstspace"> </span>auslesen<span class="text lstspace"> </span>und<span class="text lstspace"> </span>auswerten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">41</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>((UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC1))){</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">42</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>uart_rx(D_Stepper);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">43</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_clrscr();</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">44</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_puts(”<span class="text" style="color:#000000;">Gehe<span class="text lstspace"> </span>zu<span class="text lstspace"> </span>Winkel:<span class="text lstspace"> </span></span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">45</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_puts(Winkel);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">46</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_puts(”<span class="text" style="color:#000000;">\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">47</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">48</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">else</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">49</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>lcd_puts(”<span class="text" style="color:#000000;">Keine<span class="text lstspace"> </span>Antwort\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">50</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">51</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>wdt_reset();</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">52</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">53</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(”<span class="text" style="color:#000000;">Winkel:<span class="text lstspace"> </span></span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">54</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(Winkel);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">55</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>lcd_puts(”<span class="text lstspace" style="color:#000000;"> </span><span class="text" style="color:#000000;">Erreicht\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">56</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Bewegung<span class="text lstspace"> </span>abgeschlossen<span class="text lstspace"> </span>an<span class="text lstspace"> </span>RapidForm<span class="text lstspace"> </span>melden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">57</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>uart_put_string(”<span class="text" style="color:#000000;">0\r\n</span>”,<span class="text lstspace"> </span>D_RapidForm);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">58</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">break</span>;</span></td>
</tr>
</table></figure><figure id="LST18" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 18: </span>Funktion: string zerlegen Isel()</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>String_zerlegen_Isel(<span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>str_rx,<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>Position,<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>Winkel)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text" style="color:#008000;">0M5200,<span class="text lstspace"> </span>+600</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text" style="color:#008000;">Achse<span class="text lstspace"> </span>M<span class="text lstspace"> </span>Position,<span class="text lstspace"> </span>+Geschwindigkeit</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>Achse=”<span class="text" style="color:#000000;">0</span>”;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Achse[0]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>str_rx[1];<span class="text lstspace">      </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Achse<span class="text lstspace"> </span>setzen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Achse[1]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Ausgeben<span class="text lstspace"> </span>welche<span class="text lstspace"> </span>Achse<span class="text lstspace"> </span>gewaehlt<span class="text lstspace"> </span>wurde</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(atoi(Achse)==0){</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text" style="color:#000000;">Achse:<span class="text lstspace"> </span></span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(Achse);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text lstspace" style="color:#000000;"> </span><span class="text" style="color:#000000;">(Rotation)\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span>(atoi(Achse)==1){</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text" style="color:#000000;">Achse:<span class="text lstspace"> </span></span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(Achse);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>lcd_puts(”<span class="text lstspace" style="color:#000000;"> </span><span class="text" style="color:#000000;">(Hoehe)<span class="text lstspace">   </span>\n</span>”);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Anzahl<span class="text lstspace"> </span>der<span class="text lstspace"> </span>Schritte<span class="text lstspace"> </span>aus<span class="text lstspace"> </span>dem<span class="text lstspace"> </span>String<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>c;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>i<span class="text lstspace"> </span>=<span class="text lstspace"> </span>0;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">do</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">22</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>c<span class="text lstspace"> </span>=<span class="text lstspace"> </span>str_rx[i<span class="text lstspace"> </span>+<span class="text lstspace"> </span>3];</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">23</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">,</span>’)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">24</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>Position[i]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>c;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">25</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>i++;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">26</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">27</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(i<span class="text lstspace"> </span>&lt;<span class="text lstspace"> </span>20<span class="text lstspace"> </span>&amp;&amp;<span class="text lstspace"> </span>c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’<span class="text lstspace"> </span>&amp;&amp;<span class="text lstspace"> </span>c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">,</span>’);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">28</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>Position[i]<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>0<span class="text lstspace"> </span>Terminieren</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">29</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>int32_t<span class="text lstspace"> </span>z;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">30</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>int32_t<span class="text lstspace"> </span>y;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">31</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>z<span class="text lstspace"> </span>=<span class="text lstspace"> </span>atol(Position);<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">String<span class="text lstspace"> </span>in<span class="text lstspace"> </span>Zahl(long)<span class="text lstspace"> </span>umwandeln</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">32</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>y<span class="text lstspace"> </span>=<span class="text lstspace"> </span>z<span class="text lstspace"> </span>/<span class="text lstspace"> </span>7200;<span class="text lstspace">             </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Berechnung<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Winkel</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">33</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>z<span class="text lstspace"> </span>=<span class="text lstspace"> </span>(z<span class="text lstspace"> </span>*<span class="text lstspace"> </span>71111)<span class="text lstspace">  </span>/1024;<span class="text lstspace">   </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Berechnung<span class="text lstspace"> </span>der<span class="text lstspace"> </span>Schritte</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">34</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ltoa(y,<span class="text lstspace"> </span>Winkel,<span class="text lstspace">            </span>10<span class="text lstspace"> </span>);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Winekl<span class="text lstspace"> </span>in<span class="text lstspace"> </span>String<span class="text lstspace"> </span>umwandeln</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">35</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>ltoa(z,<span class="text lstspace"> </span>Position,<span class="text lstspace">    </span>10<span class="text lstspace"> </span>);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Schritte<span class="text lstspace"> </span>in<span class="text lstspace"> </span>String<span class="text lstspace"> </span>umwandeln</span></span></td>
</tr>
</table></figure></section></section></section>
        </div>
    <footer class="footer">June 25, 2012<a href="Ch5.S5.html" title="5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5.5 </span>Kommunikation mit RapidForm2004</span></a><a href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.7 </span>Platinenlayout und 19”-Einschub</span></a>
      </footer>
      </div>
    </body>
</html>
