<!DOCTYPE html><html>
  <head>
    <title>5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf</title>
    <!--Generated by LaTeXML (version 0.7.9alpha) on 2012-06-25T23:30:52+02:00.
        See http://dlmf.nist.gov/LaTeXML/-->
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="start" href="Praxisbericht.html" title="">
    <link rel="prev" href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="next" href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf">
    <link rel="stylesheet" type="text/css" href="core.css">
    <link rel="stylesheet" type="text/css" href="navbar-left.css">
  </head>
  <body>
    <nav class="navbar"><a href="Praxisbericht.html" title="" class="ref start">?</a>
    
  <ul class="toc">
  <li class="tocentry">
<a href="Praxisbericht.html" title="" class="ref toc">?</a>
  <ul class="toc">
  <li class="tocentry"><a href="Ch1.html" title="Chapter 1 Hinweise zum Dokument" class="ref toc"><span class="text reftitle"><span class="tag">1 </span>Hinweise zum Dokument</span></a></li>
  <li class="tocentry"><a href="Ch2.html" title="Chapter 2 Einleitung" class="ref toc"><span class="text reftitle"><span class="tag">2 </span>Einleitung</span></a></li>
  <li class="tocentry"><a href="Ch3.html" title="Chapter 3 Vorstellung der vorhandenen Hardware" class="ref toc"><span class="text reftitle"><span class="tag">3 </span>Vorstellung der vorhandenen Hardware</span></a></li>
  <li class="tocentry"><a href="Ch4.html" title="Chapter 4 Vorstellung der vorhandenen Software" class="ref toc"><span class="text reftitle"><span class="tag">4 </span>Vorstellung der vorhandenen Software</span></a></li>
  <li class="tocentry">
<a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a>
  <ul class="toc">
  <li class="tocentry self">
<span class="ref toc here"><span class="text reftitle"><span class="tag">5.1 </span>Bereitstellen grundlegender Funktionalitäten</span></span>
  <ul class="toc">
  <li class="tocentry"><a href="#SS1" title="5.1.1 Taster ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1.1 </span>Taster</span></a></li>
  <li class="tocentry"><a href="#SS2" title="5.1.2 LEDs ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1.2 </span>LEDs</span></a></li>
  <li class="tocentry"><a href="#SS3" title="5.1.3 Ansteuerung des LC-Display ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1.3 </span>Ansteuerung des LC-Display</span></a></li>
  <li class="tocentry"><a href="#SS4" title="5.1.4 RS-232-Schnittstelle ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.1.4 </span>RS-232-Schnittstelle</span></a></li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.2 </span>Befehlssätze</span></a></li>
  <li class="tocentry"><a href="Ch5.S3.html" title="5.3 Kommunikation mit der vorhandenen Schrittmotorsteuerung ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.3 </span>Kommunikation mit der vorhandenen Schrittmotorsteuerung</span></a></li>
  <li class="tocentry"><a href="Ch5.S4.html" title="5.4 Verbesserungen an der vorhandenen Hardware ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.4 </span>Verbesserungen an der vorhandenen Hardware</span></a></li>
  <li class="tocentry"><a href="Ch5.S5.html" title="5.5 Kommunikation mit RapidForm2004 ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.5 </span>Kommunikation mit RapidForm2004</span></a></li>
  <li class="tocentry"><a href="Ch5.S6.html" title="5.6 Auswerte-Funktionen ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.6 </span>Auswerte-Funktionen</span></a></li>
  <li class="tocentry"><a href="Ch5.S7.html" title="5.7 Platinenlayout und 19”-Einschub ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref toc"><span class="text reftitle"><span class="tag">5.7 </span>Platinenlayout und 19”-Einschub</span></a></li>
    </ul>
</li>
  <li class="tocentry"><a href="Ch6.html" title="Chapter 6 Probleme und Lösungen" class="ref toc"><span class="text reftitle"><span class="tag">6 </span>Probleme und Lösungen</span></a></li>
  <li class="tocentry"><a href="Ch7.html" title="Chapter 7 Fazit und weitere Möglichkeiten" class="ref toc"><span class="text reftitle"><span class="tag">7 </span>Fazit und weitere Möglichkeiten</span></a></li>
  <li class="tocentry"><a href="bib.html" title="Bibliography" class="ref toc"><span class="text reftitle">Bibliography</span></a></li>
  <li class="tocentry"><a href="idx.html" title="Index" class="ref toc"><span class="text reftitle">Index</span></a></li>
    </ul>
</li>
    </ul>
      </nav>
    <div class="main">
    <header class="header"><a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref up"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a><a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a><a href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.2 </span>Befehlssätze</span></a>
      </header>
    <div class="content">
<section class="section"><hgroup><h1 class="title">
<span class="tag">5.1 </span>Bereitstellen grundlegender Funktionalitäten</h1></hgroup><div id="p1" class="para"><p class="p">Im ersten Schritt ging es darum, den Mikrocontroller so zu programmieren, dass dieser die für dieses Projekt grundlegenden Funktionalitäten bereitstellen kann.<br class="break">Der Mikrocontroller befand sich vorerst auf dem <span class="text" style="background-color:#D9D9FF;">STK500</span>(siehe Kapitel <a href="Ch3.S4.html#SS1" title="3.4.1 Entwicklerboard STK500 ‣ 3.4 Mikrocontroller ‣ Chapter 3 Vorstellung der vorhandenen Hardware" class="ref"><span class="text reftag">3.4.1</span></a>). Um dessen Komponenten im Mikrocontroller nutzen zu können, müssen dafür Register initialisiert werden oder Funktionalitäten wie z.B. Bibliotheken für das LC-Display bereit gestellt werden.<br class="break">Die folgenden Kapitel beschreiben den Programmcode, der notwendig ist um diese Funktionalitäten bereitzustellen.</p></div>
<section id="SS1" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.1.1 </span>Taster</h1></hgroup><div id="SS1.p1" class="para"><p class="p">Um die Taster des STK500 im Mikrocontroller nutzen zu können müssen diese mit dem Mikrocontroller verbunden und entprellt<span class="note footnote"><sup class="mark">5</sup><span class="note_content_outer"><span class="note_content"><sup class="mark">5</sup>Als <span class="text" style="background-color:#D9D9FF;">Prellen</span> bezeichnet man das ungewollte mehrfache Schalten eines mechanischen Schalters bei einem einzelnen Schaltvorgang.</span></span></span> werden.<br class="break">Dazu muss die Stiftleiste von <em class="emph">PortA</em> mit der Stiftleiste für die Taster verbunden werden. Das Entprellen der Taster wird softwareseitig realisiert. Dies bietet sich bei einem Mikrocontroler an. Dazu gibt es vorgefertigte Bibliotheken die genutzt werden können. Im Projekt wurde die Bibliothek <span class="text typewriter" style="background-color:#FFFFE6;">Debounce.h</span><cite class="cite">()</cite> von Peter Dannegger genutzt. Sie ist sehr komfortabl und funktionsreich und basiert auf <span class="text" style="background-color:#D9D9FF;">Timer-Interrupts</span>. Um sie zu nutzen wird die Datei <span class="text typewriter" style="background-color:#FFFFE6;">Debounce.h</span> in das Projektverzeichnis kopiert und mit Zeile 1 des Codelisting <a href="#LST1" title="1 ‣ 5.1.1 Taster ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">1</span></a> in das Programm eingebunden. Die Zeilen 2-10 spiegeln die Funktion zum Initialisieren der Bibliothek wieder. Diese Zeilen müssen auf den jeweils verwendeten Mikrocontroller angepasst werden.<br class="break">Durch die Verwendung der Bibliothek ist es möglich Funktionen wie z.B. <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">get_key_press()</span> zu nutzen um den Status der Taster prellfrei auszulesen und diese Information für Entscheidungen im Programmablauf zu verwenden.</p></div>
<figure id="LST1" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 1: </span>Taster</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">include<span class="text lstspace"> </span>”Debounce.h”<span class="text lstspace">                           </span>//<span class="text lstspace"> </span>Taster<span class="text lstspace"> </span>entprellen</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote">void<span class="text lstspace">    </span>debounce_init<span class="text lstspace">           </span>(void)<span class="text lstspace"> </span>{<span class="text lstspace">        </span>//<span class="text lstspace"> </span>Taster<span class="text lstspace"> </span>entprellen</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>KEY_DDR<span class="text lstspace"> </span>&amp;=<span class="text lstspace"> </span>~ALL_KEYS;<span class="text lstspace">                   </span>//<span class="text lstspace"> </span>configure<span class="text lstspace"> </span>key<span class="text lstspace"> </span>port<span class="text lstspace"> </span>for<span class="text lstspace"> </span>input</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>KEY_PORT<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>ALL_KEYS;<span class="text lstspace">                   </span>//<span class="text lstspace"> </span>and<span class="text lstspace"> </span>turn<span class="text lstspace"> </span>on<span class="text lstspace"> </span>pull<span class="text lstspace"> </span>up<span class="text lstspace"> </span>resistors</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>TCCR0B<span class="text lstspace"> </span>=<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>CS02)<span class="text lstspace"> </span>|<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>CS00);<span class="text lstspace">     </span>//<span class="text lstspace"> </span>divide<span class="text lstspace"> </span>by<span class="text lstspace"> </span>1024</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace"> </span>preload<span class="text lstspace"> </span>for<span class="text lstspace"> </span>10ms</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>TCNT0<span class="text lstspace"> </span>=<span class="text lstspace"> </span>(uint8_t)<span class="text lstspace"> </span>(int16_t)<span class="text lstspace"> </span>-(F_CPU<span class="text lstspace"> </span>/<span class="text lstspace"> </span>1024<span class="text lstspace"> </span>*<span class="text lstspace"> </span>10<span class="text lstspace"> </span>*<span class="text lstspace"> </span>10e-3<span class="text lstspace"> </span>+<span class="text lstspace"> </span>0.5);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>TIMSK0<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>TOIE0;<span class="text lstspace">                   </span>//<span class="text lstspace"> </span>enable<span class="text lstspace"> </span>timer<span class="text lstspace"> </span>interrupt</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>sei();<span class="text lstspace">                                  </span>//<span class="text lstspace"> </span>global<span class="text lstspace"> </span>enable<span class="text lstspace"> </span>Interrupts</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote">if<span class="text lstspace"> </span>(get_key_press(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>KEY4))</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>menu_select(&amp;menu_context);<span class="text lstspace">             </span>//<span class="text lstspace"> </span>Aktuellen<span class="text lstspace"> </span>Menuepunkt<span class="text lstspace"> </span>auswaehlen</span></td>
</tr>
</table></figure></section><section id="SS2" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.1.2 </span>LEDs</h1></hgroup><div id="SS2.p1" class="para"><p class="p">LEDs sollen im Programmablauf genutzt werden können, um z.B. Fehler zu signalisieren.<br class="break">Dazu muss zuerst die Stiftleiste von <em class="emph">PortB</em> mit der LED Stiftleiste des STK500 verbunden werden. Um LEDs an <em class="emph">PortB</em> betreiben zu können müssen die entsprechenden Pins im <span class="text" style="background-color:#D9D9FF;">Register</span> <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">DDRB</span> als Ausgänge definiert werden. Dies geschieht in Zeile 1 des Codelisting <a href="#LST2" title="2 ‣ 5.1.2 LEDs ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">2</span></a>. Die Bibliothek zum Entprellen der Taster nutzt die Variablen <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">LED_DDR</span> und <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">LED_PORT</span>. Diese Variablen werden auch hier genutzt um auf die Register zuzugreifen. Dies gewährleistet eine bessere Übersicht. Die Werte im 8-Bit Register <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">LED_PORT</span> spiegeln die Spannungen an den Pins des <em class="emph">PortB</em> am Mikrocontroller wieder. Da die LEDs auf dem STK500 mit <span class="text" style="background-color:#D9D9FF;">active-low-Logik</span> betrieben werden, muss das jeweilige Bit gelöscht, also auf ”0”, gesetzt werden damit die LED leuchtet. Um alle Bits in einem Register zu verändern kann das Register mit einem 2-stelligen Hex-Wert (8-Bit) oder einem 8 stelligen binären Bitmuster beschrieben werden. In Zeile 2 werden alle Bits mit dem Hex-Wert <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">0xFF</span> auf ”1” gesetzt und somit alle LEDs ausgeschaltet. Um ein einzelnes Bit zu verändern, können die Anweisungen in den Zeilen 3 und 4 verwendet werden. Dabei steht das ”X” in <em class="emph">PBX</em> für die x-te Stelle im Register die gesetzt oder gelöscht werden soll.<br class="break">Es ist damit möglich im Programmablauf einzelne LEDs anzusteuern.</p></div>
<figure id="LST2" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 2: </span>LEDs</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">LED_DDR<span class="text lstspace">   </span>=<span class="text lstspace"> </span>0xFF;<span class="text lstspace">                 </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">LED<span class="text lstspace"> </span>Port<span class="text lstspace"> </span>Richtung<span class="text lstspace"> </span>definieren<span class="text lstspace"> </span>(Ausgang)</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote">LED_PORT<span class="text lstspace">  </span>=<span class="text lstspace"> </span>0xFF;<span class="text lstspace">                  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">LEDs<span class="text lstspace"> </span>ausschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote">LED_PORT<span class="text lstspace"> </span>&amp;=<span class="text lstspace"> </span>~((1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>PBX));<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">loescht<span class="text lstspace"> </span>Bit<span class="text lstspace"> </span>an<span class="text lstspace"> </span>PortB<span class="text lstspace"> </span>-<span class="text lstspace"> </span>LED<span class="text lstspace"> </span>an</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote">LED_PORT<span class="text lstspace"> </span>|=<span class="text lstspace">  </span>((1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>PBX));<span class="text lstspace">         </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">setzt<span class="text lstspace">  </span>Bit<span class="text lstspace"> </span>an<span class="text lstspace"> </span>PortB<span class="text lstspace"> </span>-<span class="text lstspace"> </span>LED<span class="text lstspace"> </span>aus</span></span></td>
</tr>
</table></figure></section><section id="SS3" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.1.3 </span>Ansteuerung des LC-Display</h1></hgroup><div id="SS3.p1" class="para"><p class="p">Um den aktuellen Status des Motor komfortabel in Textform anzeigen zu können und die Schrittmotorkarte <em class="emph">menübasiert</em> ansteuern zu können wird ein <span class="text" style="background-color:#D9D9FF;">LC-Display</span> verwendet. Das verwendete Display ist <span class="text" style="background-color:#D9D9FF;">alpha numerisch</span> und kann 4x20 Zeichen anzeigen.<br class="break">Die meisten LC-Displays werden auf die gleiche Weise angesteuert. Hier gibt es fertige Bibliotheken die frei genutzt werden können. Im Projekt wurde die Bibliothek von Peter Fleury <cite class="cite">()</cite> verwendet. Die Bibliothek wird heruntergeladen und die Dateien <span class="text typewriter" style="background-color:#FFFFE6;">lcd.c</span> und <span class="text typewriter" style="background-color:#FFFFE6;">lcd.h</span> in das Projektverzeichnis entpackt. Die Bibliothek wird mit <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">#include ''lcd.h''</span> eingebunden. In der <span class="text typewriter" style="background-color:#FFFFE6;">lcd.h</span> müssen dann noch die Daten des Displays eingegeben werden (siehe Codelisting <a href="#LST3" title="3 ‣ 5.1.3 Ansteuerung des LC-Display ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">3</span></a> Zeilen 2–10).<br class="break">Danach kann das Display im Programm mit den Befehlen aus Zeile 12–21 angesteuert werden.</p></div>
<figure id="LST3" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 3: </span>lcd.h (Auszug)</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">/*<span class="text" style="color:#008000;">*&lt;<span class="text lstspace"> </span>Use<span class="text lstspace"> </span>0<span class="text lstspace"> </span>for<span class="text lstspace"> </span>HD44780<span class="text lstspace"> </span>controller,<span class="text lstspace">  </span>1<span class="text lstspace"> </span>for<span class="text lstspace"> </span>KS0073<span class="text lstspace"> </span>controller<span class="text lstspace"> </span></span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_CONTROLLER_KS0073<span class="text lstspace"> </span>0</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_LINES<span class="text lstspace">           </span>4<span class="text lstspace">          </span>/*<span class="text" style="color:#008000;">*&lt;<span class="text lstspace"> </span>number<span class="text lstspace"> </span>of<span class="text lstspace"> </span>visible<span class="text lstspace"> </span>lines<span class="text lstspace"> </span>of<span class="text lstspace"> </span>the<span class="text lstspace"> </span>display<span class="text lstspace"> </span></span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_DISP_LENGTH<span class="text lstspace">    </span>19<span class="text lstspace">           </span>/**&lt;<span class="text lstspace"> </span>visibles<span class="text lstspace"> </span>characters<span class="text lstspace"> </span>per<span class="text lstspace"> </span>line<span class="text lstspace"> </span>of<span class="text lstspace"> </span>the<span class="text lstspace"> </span>display<span class="text lstspace"> </span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_LINE_LENGTH<span class="text lstspace">  </span>0x40<span class="text lstspace">           </span>/*<span class="text" style="color:#008000;">*&lt;<span class="text lstspace"> </span>internal<span class="text lstspace"> </span>line<span class="text lstspace"> </span>length<span class="text lstspace"> </span>of<span class="text lstspace"> </span>the<span class="text lstspace"> </span>display<span class="text lstspace">   </span></span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_START_LINE1<span class="text lstspace">  </span>0x00<span class="text lstspace">           </span>/**&lt;<span class="text lstspace"> </span>DDRAM<span class="text lstspace"> </span>address<span class="text lstspace"> </span>of<span class="text lstspace"> </span>first<span class="text lstspace"> </span>char<span class="text lstspace"> </span>of<span class="text lstspace"> </span>line<span class="text lstspace"> </span>1<span class="text lstspace"> </span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_START_LINE2<span class="text lstspace">  </span>0x40<span class="text lstspace">           </span>/*<span class="text" style="color:#008000;">*&lt;<span class="text lstspace"> </span>DDRAM<span class="text lstspace"> </span>address<span class="text lstspace"> </span>of<span class="text lstspace"> </span>first<span class="text lstspace"> </span>char<span class="text lstspace"> </span>of<span class="text lstspace"> </span>line<span class="text lstspace"> </span>2<span class="text lstspace"> </span></span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_START_LINE3<span class="text lstspace">  </span>0x14<span class="text lstspace">           </span>/**&lt;<span class="text lstspace"> </span>DDRAM<span class="text lstspace"> </span>address<span class="text lstspace"> </span>of<span class="text lstspace"> </span>first<span class="text lstspace"> </span>char<span class="text lstspace"> </span>of<span class="text lstspace"> </span>line<span class="text lstspace"> </span>3<span class="text lstspace"> </span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_START_LINE4<span class="text lstspace">  </span>0x54<span class="text lstspace">           </span>/*<span class="text" style="color:#008000;">*&lt;<span class="text lstspace"> </span>DDRAM<span class="text lstspace"> </span>address<span class="text lstspace"> </span>of<span class="text lstspace"> </span>first<span class="text lstspace"> </span>char<span class="text lstspace"> </span>of<span class="text lstspace"> </span>line<span class="text lstspace"> </span>4<span class="text lstspace"> </span></span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>LCD_WRAP_LINES<span class="text lstspace">      </span>1<span class="text lstspace">           </span>/**&lt;<span class="text lstspace"> </span>0:<span class="text lstspace"> </span>no<span class="text lstspace"> </span>wrap,<span class="text lstspace"> </span>1:<span class="text lstspace"> </span>wrap<span class="text lstspace"> </span>at<span class="text lstspace"> </span>end<span class="text lstspace"> </span>of<span class="text lstspace"> </span>visibile<span class="text lstspace"> </span>line<span class="text lstspace"> </span>*/</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace"> </span>Funktionen<span class="text lstspace"> </span>zum<span class="text lstspace"> </span>Ansteuern<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Displays:</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_init(uint8_t<span class="text lstspace"> </span>dispAttr);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_clrscr(void);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_home(void);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_gotoxy(uint8_t<span class="text lstspace"> </span>x,<span class="text lstspace"> </span>uint8_t<span class="text lstspace"> </span>y);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_putc(char<span class="text lstspace"> </span>c);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_puts(const<span class="text lstspace"> </span>char<span class="text lstspace"> </span>*s);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_puts_p(const<span class="text lstspace"> </span>char<span class="text lstspace"> </span>*progmem_s);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_command(uint8_t<span class="text lstspace"> </span>cmd);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote">extern<span class="text lstspace"> </span>void<span class="text lstspace"> </span>lcd_data(uint8_t<span class="text lstspace"> </span>data);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>lcd_puts_P(__s)<span class="text lstspace"> </span>lcd_puts_p(PSTR(__s))</span></td>
</tr>
</table></figure></section><section id="SS4" class="subsection"><hgroup><h1 class="title">
<span class="tag">5.1.4 </span>RS-232-Schnittstelle</h1></hgroup><div id="SS4.p1" class="para">
<p class="p"><span class="text" style="background-color:#D9D9FF;">RS-232</span> ist der Name der am häufigsten verwendeten seriellen Schnittstelle um Daten zwischen zwei elektronischen Geräten hin und her zu senden. <cite class="cite">()</cite><br class="break">Auf dem STK500 ist bereits eine serielle Schnittstelle vorbereitet. Um diese nutzen zu können, müssen die Pins 3 und 4 des <em class="emph">PortC</em> (erster <span class="text" style="background-color:#D9D9FF;">UART</span>) des Mikrocontrollers mit der Stiftleiste <em class="emph">Rx/Tx</em> auf dem STK500 verbunden werden. Eine weitere Schnittstelle wurde auf einem Steckbrett aufgebaut. Diese wurde mit den Pins 1 und 2 des <em class="emph">PortC</em> (zweiter UART) des Mikrocontrollers verbunden. Um die Schnittstellen im Mikrocontroller nutzen zu können müssen diese noch durch setzen von Bits in den entsprechenden Registern des Mikrocontrollers aktiviert werden.<br class="break">Das Codelisting <a href="#LST4" title="4 ‣ 5.1.4 RS-232-Schnittstelle ‣ 5.1 Bereitstellen grundlegender Funktionalitäten ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref"><span class="text reftag">4</span></a> teilt sich in 4 wesentliche Bereiche: <br class="break"></p>
<ul id="Ch5.I1" class="itemize">
<li id="Ch5.I1.i1" class="item"><div id="Ch5.I1.i1.p1" class="para"><p class="p">Zeilen 1 – 2: Setzen der Baudrate und einbinden der benötigten Bibliotheken.</p></div></li>
<li id="Ch5.I1.i2" class="item"><div id="Ch5.I1.i2.p1" class="para"><p class="p">Zeilen 3 – 17: Initialisieren der Schnittstellen durch setzen der richtigen Bits in den entsprechenden Registern.
</p></div></li>
<li id="Ch5.I1.i3" class="item"><div id="Ch5.I1.i3.p1" class="para"><p class="p">Zeilen 18 – 35: Funktionen zum Senden von Daten</p></div></li>
<li id="Ch5.I1.i4" class="item"><div id="Ch5.I1.i4.p1" class="para"><p class="p">Zeilen 36 – 65: Funktionen zum Empfangen von Daten</p></div></li>
</ul>
</div>
<figure id="LST4" class="listing language_C"><figcaption class="caption"><span class="tag">Listing 4: </span>RS-232</figcaption><table class="tabular">
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">1</span></td>
    <td class="td"><span class="text lstline footnote">define<span class="text lstspace"> </span>BAUD<span class="text lstspace"> </span>9600<span class="text lstspace">               </span>//<span class="text lstspace"> </span>BAUD<span class="text lstspace"> </span>Rate<span class="text lstspace"> </span>definieren</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">2</span></td>
    <td class="td"><span class="text lstline footnote">keywordstyle <span class="text lstdirectives">include</span><span class="text lstspace"> </span>&lt;util/setbaud.h&gt;<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>Funktionen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">3</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>Initialisieren</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">4</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>uart_init<span class="text lstspace">                </span>()<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">5</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>0<span class="text lstspace"> </span>-<span class="text lstspace"> </span>IN<span class="text lstspace"> </span>(Rapidform<span class="text lstspace"> </span>Software/Terminal)</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">6</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UBRR0H<span class="text lstspace"> </span>=<span class="text lstspace"> </span>UBRRH_VALUE;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">7</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UBRR0L<span class="text lstspace"> </span>=<span class="text lstspace"> </span>UBRRL_VALUE;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">8</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR0C<span class="text lstspace"> </span>=<span class="text lstspace"> </span>(3<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>UCSZ00);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">9</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR0B<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>TXEN0);<span class="text lstspace">    </span>//<span class="text" style="color:#008000;">Transmitter<span class="text lstspace"> </span>Enabled</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">10</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR0B<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXEN0);<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>RX<span class="text lstspace"> </span>einschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">11</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>1<span class="text lstspace"> </span>-<span class="text lstspace"> </span>OUT<span class="text lstspace"> </span>(Stepper<span class="text lstspace"> </span>Karte/Drehtisch)</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">12</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UBRR1H<span class="text lstspace"> </span>=<span class="text lstspace"> </span>UBRRH_VALUE;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">13</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UBRR1L<span class="text lstspace"> </span>=<span class="text lstspace"> </span>UBRRL_VALUE;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">14</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR1C<span class="text lstspace"> </span>=<span class="text lstspace"> </span>(3<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>UCSZ00);</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">15</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR1B<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>TXEN1);<span class="text lstspace">    </span>//<span class="text" style="color:#008000;">Transmitter<span class="text lstspace"> </span>Enabled</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">16</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>UCSR1B<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXEN1);<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>RX<span class="text lstspace"> </span>einschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">17</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">18</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>senden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">19</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>uart_put_charater<span class="text lstspace">        </span>(<span class="text lstkeywords" style="color:#FF0000;">unsigned</span><span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>c,<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>dir)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">20</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(dir<span class="text lstspace"> </span>==<span class="text lstspace"> </span>D_RapidForm)<span class="text lstspace"> </span>{<span class="text lstspace">       </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">To<span class="text lstspace"> </span>Rapidform</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">21</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(!(UCSR0A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>UDRE0)))<span class="text lstspace"> </span>{}//<span class="text" style="color:#008000;">warten<span class="text lstspace"> </span>bis<span class="text lstspace"> </span>Senden<span class="text lstspace"> </span>moeglich</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">22</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>UDR0<span class="text lstspace"> </span>=<span class="text lstspace"> </span>c;<span class="text lstspace">            </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">sende<span class="text lstspace"> </span>Zeichen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">23</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">24</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span><span class="text lstspace"> </span>{<span class="text lstspace">                              </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">To<span class="text lstspace"> </span>Stepper</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">25</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(!(UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>UDRE1)))<span class="text lstspace"> </span>{}//<span class="text" style="color:#008000;">warten<span class="text lstspace"> </span>bis<span class="text lstspace"> </span>Senden<span class="text lstspace"> </span>moeglich</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">26</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>UDR1<span class="text lstspace"> </span>=<span class="text lstspace"> </span>c;<span class="text lstspace">            </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">sende<span class="text lstspace"> </span>Zeichen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">27</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">28</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">29</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>String<span class="text lstspace"> </span>senden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">30</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>uart_put_string<span class="text lstspace">                </span>(<span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*s,<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>dir)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">31</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(*s){<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">so<span class="text lstspace"> </span>lange<span class="text lstspace"> </span>*s<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’\0’<span class="text lstspace"> </span>Terminierungszeichen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">32</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>uart_put_charater(*s,<span class="text lstspace"> </span>dir);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zeichenweise<span class="text lstspace"> </span>senden</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">33</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>s++;</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">34</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">35</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">36</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>empfangen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">37</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace">        </span>uart_get_character<span class="text lstspace">        </span>(<span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>dir)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">38</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(dir<span class="text lstspace"> </span>==<span class="text lstspace"> </span>D_RapidForm)<span class="text lstspace"> </span>{<span class="text lstspace">       </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Aus<span class="text lstspace"> </span>RapidForm<span class="text lstspace"> </span>Register<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">39</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(!(UCSR0A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC0)))<span class="text lstspace"> </span>;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">warten<span class="text lstspace"> </span>bis<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>verfuegbar</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">40</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>UDR0;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zeichen<span class="text lstspace"> </span>aus<span class="text lstspace"> </span>UDR<span class="text lstspace"> </span>an<span class="text lstspace"> </span>Aufrufer<span class="text lstspace"> </span>zurueckgeben</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">41</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">42</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(dir<span class="text lstspace"> </span>==<span class="text lstspace"> </span>D_Stepper)<span class="text lstspace"> </span>{<span class="text lstspace">               </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Aus<span class="text lstspace"> </span>Schrittmotor<span class="text lstspace"> </span>Register<span class="text lstspace"> </span>auslesen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">43</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(!(UCSR1A<span class="text lstspace"> </span>&amp;<span class="text lstspace"> </span>(1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>RXC1)))<span class="text lstspace"> </span>;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">warten<span class="text lstspace"> </span>bis<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>verfuegbar</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">44</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>UDR1;<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zeichen<span class="text lstspace"> </span>aus<span class="text lstspace"> </span>UDR<span class="text lstspace"> </span>an<span class="text lstspace"> </span>Aufrufer<span class="text lstspace"> </span>zurueckgeben</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">45</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">46</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">return</span><span class="text lstspace"> </span>-1;<span class="text lstspace">    </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Wenn<span class="text lstspace"> </span>nichts<span class="text lstspace"> </span>ausgelesen<span class="text lstspace"> </span>wurde<span class="text lstspace"> </span>-1<span class="text lstspace"> </span>zurueckgeben</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">47</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">48</span></td>
    <td class="td"><span class="text lstline footnote">//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">UART<span class="text lstspace"> </span>String<span class="text lstspace"> </span>empfangen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">49</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstkeywords" style="color:#FF0000;">void</span><span class="text lstspace">        </span>uart_get_string<span class="text lstspace">                </span>(<span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>*<span class="text lstspace"> </span>string_in,<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>dir)<span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">50</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">char</span><span class="text lstspace"> </span>c;<span class="text lstspace">              </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Einzelnes<span class="text lstspace"> </span>Zeichen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">51</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">int</span><span class="text lstspace"> </span>i<span class="text lstspace"> </span>=<span class="text lstspace"> </span>0;<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zaehlvariable</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">52</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">do</span><span class="text lstspace"> </span>{</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">53</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>c<span class="text lstspace"> </span>=<span class="text lstspace"> </span>uart_get_character(dir);<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Einzelnes<span class="text lstspace"> </span>Zeichen<span class="text lstspace"> </span>holen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">54</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\r</span>’)<span class="text lstspace"> </span>{<span class="text lstspace">           </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Wenn<span class="text lstspace"> </span>keinn<span class="text lstspace"> </span>\r</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">55</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>*string_in<span class="text lstspace"> </span>=<span class="text lstspace"> </span>c;<span class="text lstspace">           </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zeichen<span class="text lstspace"> </span>in<span class="text lstspace"> </span>Empfangsstring<span class="text lstspace"> </span>schreiben</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">56</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>string_in<span class="text lstspace"> </span>+=<span class="text lstspace"> </span>1;<span class="text lstspace">          </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Adresse<span class="text lstspace"> </span>des<span class="text lstspace"> </span>Empfangsstring<span class="text lstspace"> </span>um<span class="text lstspace"> </span>1<span class="text lstspace"> </span>ink</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">57</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                        </span>i++;<span class="text lstspace">                     </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">Zaehlvariable<span class="text lstspace"> </span>um<span class="text lstspace"> </span>1<span class="text lstspace"> </span>erhoehen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">58</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>}</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">59</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>}<span class="text lstspace"> </span><span class="text lstkeywords" style="color:#FF0000;">while</span><span class="text lstspace"> </span>(i<span class="text lstspace"> </span>&lt;<span class="text lstspace"> </span>100<span class="text lstspace"> </span>&amp;&amp;<span class="text lstspace"> </span>c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\r</span>’<span class="text lstspace"> </span>&amp;&amp;<span class="text lstspace"> </span>c<span class="text lstspace"> </span>!=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\n</span>’);<span class="text lstspace"> </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">So<span class="text lstspace"> </span>lange<span class="text lstspace"> </span>bis<span class="text lstspace"> </span>\r<span class="text lstspace"> </span>\n<span class="text lstspace"> </span>o.<span class="text lstspace"> </span>&gt;100<span class="text lstspace"> </span>Zeichen</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">60</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span>*string_in<span class="text lstspace"> </span>=<span class="text lstspace"> </span>’<span class="text" style="color:#000000;">\0</span>’;<span class="text lstspace">                       </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">0<span class="text lstspace"> </span>Terminieren</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">61</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">if</span><span class="text lstspace"> </span>(dir<span class="text lstspace"> </span>==<span class="text lstspace"> </span>D_Stepper)</span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">62</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>LED_PORT<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(<span class="text lstspace"> </span>1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>LED3<span class="text lstspace"> </span>);<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">”Daten<span class="text lstspace"> </span>Vorhanden”<span class="text lstspace"> </span>LED<span class="text lstspace"> </span>ausschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">63</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">        </span><span class="text lstkeywords" style="color:#FF0000;">else</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">64</span></td>
    <td class="td"><span class="text lstline footnote"><span class="text lstspace">                </span>LED_PORT<span class="text lstspace"> </span>|=<span class="text lstspace"> </span>(<span class="text lstspace"> </span>1<span class="text lstspace"> </span>&lt;&lt;<span class="text lstspace"> </span>LED2<span class="text lstspace"> </span>);<span class="text lstspace">  </span>//<span class="text lstspace" style="color:#008000;"> </span><span class="text" style="color:#008000;">”Daten<span class="text lstspace"> </span>Vorhanden”<span class="text lstspace"> </span>LED<span class="text lstspace"> </span>ausschalten</span></span></td>
</tr>
<tr class="tr">
    <td class="td linenumber"><span class="text tiny">65</span></td>
    <td class="td"><span class="text lstline footnote">}</span></td>
</tr>
</table></figure><div id="SS4.p2" class="para"><p class="p">Damit stehen die essentiellen Funktionen <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">uart_put_string(dir)</span> und <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">uart_get_string(dir)</span> zur Verfügung. Mit diesen kann der Mikrocontroller über die serielle Schnittstelle Strings senden und empfangen. Der Parameter <span class="text typewriter" style="color:#0000FF;background-color:#FFFFE6;">dir</span> gibt dabei die Schnittstelle an über die gesendet oder empfangen werden soll.</p></div></section></section>
        </div>
    <footer class="footer">June 25, 2012<a href="Ch5.html" title="Chapter 5 Zeitlicher Arbeitsablauf" class="ref previous"><span class="text reftitle"><span class="tag">5 </span>Zeitlicher Arbeitsablauf</span></a><a href="Ch5.S2.html" title="5.2 Befehlssätze ‣ Chapter 5 Zeitlicher Arbeitsablauf" class="ref next"><span class="text reftitle"><span class="tag">5.2 </span>Befehlssätze</span></a>
      </footer>
      </div>
    </body>
</html>
