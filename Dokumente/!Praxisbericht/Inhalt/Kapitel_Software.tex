\chapter{Software}
\label{cha:Software}
\todo{Einführung schreiben}
\todo{Weitere Software in Begriffen erklären. Minolta}

\section{RapidForm2004}
\label{sec:RapidForm}
Zur Erfassung am PC steht die Software RapidForm2004 der Firma TrustInus zur Verfügung. Diese ist zur Erfassung und Bearbeitung von 3D-Modellen gedacht. Sie bietet umfangreiche Möglichkeiten die aufgenommen Modelle zu verbessern, verändern und zu vermessen.\\
Die Ansteuerung des VI-900 ist durch ein \Fachbegriff{Add-In} bereits in die Software integriert. Das Add-In kann das VI-900 ansteuern und die Aufgenommenen Daten auslesen. Weiterhin kann das Add-In verschiedene Drehtische ansteuern.

\section{Entwicklungsumgebung}
Als Entwicklungsumgebung wird eine Software bezeichnet die es dem Anwender erleichtert Programme für den Mikrocontroller zu schreiben. Im allgemeinen bestehen Entwicklungsumgebungen aus einem Editor, dem Compiler und einer Programmiersoftware. Der Editor bietet dabei meist Komfortfunktionen wie Syntaxhighlighting, Autovervollständigung und Projektmanagement. \todo{besser schreiben!} 
\subsection{AVR Studio 5}
\todo{AVR Studio Eclipse Bug Defekte Biblio?}
\subsection{Eclipse}

\section{Mikrocontroller}
\todo{Codebeispiele sind zusammengefasst. Vollständiger Code im Anhang.}
\todo{Backup anlegen und cleanen!}
\subsection{Fuses}
Als Fuses werden Register bezeichnet mit denen sich, auf Hardwareebene, das Verhalten des Mikrocontroller verändern lässt. 
\todo{Fuses Tabellen aus Datenblatt!}
\begin{tabular}{|l|l|}\hline 
CKSEL &  \\ \hline 
SUT & • \\ \hline 
CKDIV8 & • \\ \hline 
CKOUT & • \\ \hline 
CKOPT & • \\ \hline 
RSTDISBL & • \\ \hline 
SPIEN & • \\ \hline 
JTAGEN & • \\ \hline 
DWEN & • \\ \hline 
OCDEN & • \\ \hline 
EESAVE & • \\ \hline 
BODEN & • \\ \hline 
BODLEVEL & • \\ \hline 
WDTON & • \\ \hline 
BOOTRST & • \\ \hline 
BOOTSZ & • \\ \hline 
Compatibility Bits & • \\ \hline 
SELFPRGEN & • \\ \hline 
HWBEN & • \\ \hline 
\end{tabular} 



\subsection{LEDs}
Das Codebeispiel \ref{lst:Lauflicht} zeigt ein einfaches Beispiel mit dem sich die Funktionalität der LEDs leicht überprüfen lässt. Bei jedem Aufruf der Funktion wird der aktuelle Status des LED Port abgefragt und der Hexwert um 1 Bit verschoben. Dadurch wird die daneben liegende LED eingeschaltet und die aktuelle aus geschaltet. Wird ein bestimmter Wert überschritten wird der Port wieder auf den Anfangszustand zurück gesetzt.
\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=2}
\lstinputlisting[label=lst:Lauflicht,caption=Funktion - Lauflicht]{Code/led_lauflicht_sample.txt}
\subsection{Taster}
\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=2}
\lstinputlisting[label=lst:Taster,caption=Taster]{Code/taster.txt}


\subsection{LCD Bibliothek}
Die meisten LC-Displays werden auf die selbe Art angesteuert. Hier gibt es fertige Bibliotheken die frei genutzt werden können. Im Projekt wird die von Peter Fleury\cite{uC:Fleury} verwendet.\\
Dazu müssen die Dateien lcd.c und lcd.h in das Arbeitsverzeichnis kopiert werden und die Bibliothek mit \emph{\#include(lcd.h)} eingebunden werden. \\
Anschließend müssen noch in der lcd.h die Daten des Display eingegeben werden.
Danach kann das Display mit den Befehlen aus Zeile 15-24 aus dem Codebeispiel \ref{lst:LCD_Def} angesteuert werden.

\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=4}
\lstinputlisting[label=lst:LCD_Def,caption=Definitionen - LCD(Auszug)]{Code/lcd_def.txt}
\subsection{RS-232}
\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=2}
\lstinputlisting[label=lst:RS232,caption=Funktionen - RS-232]{Code/rs232.txt}
\subsection{Menü Bibliothek}
Der Drehtisch kann Manuell über Taster am Einschub bedient werden. Die Menü Bibliothek gestaltet dies einfach und Komfortabel. Mit den Tasten Zurück. Select, Hoch und Runter lässt sich durch die Einzelnen Menü Punkte Navigieren.
\todo{Menü Baum erstellen!}
\subsection{Interrupts}
Viele Mikrocontroller bieten die Möglichkeit zeitkritische Subroutinen auszuführen. Wenn einer der Interrupts ausgelöst wird, wird das Hauptprogramm unterbrochen und die Entsprechende Interrupt-Service-Routine ausgeführt. Nach Beendigung der ISR wird das Hauptprogramm an der vorherigen Stelle wieder aufgenommen.\\
ISR dürfen nur sehr wenige Befehle enthalten und müssen innerhalb weniger ClockCicles abgeschlossen sein. \\
Interrupts können z.B. der Überlauf eines internen Timer sein, oder ein externens Signal an einem Pin.\\
Im Projekt werden externe Interrupts, Timer-Überlauf Interrupts und der Watchdog Interrupt genutzt. 
\subsubsection{Endschalter}
Die Endschalter sind über die Schrittmotorkarten und eine Brücke in der Steuerung mit der Mikrocontroller Platine Verbunden. Dort sind sie an 2 Interrupt Pins angeschlossen. Bei einem Flanken Wechsel an den Pins wird ein Interrupt ausgelöst. \\
Das Code-Listing \ref{lst:ISR_ES} zeigt die ISR für die Endschalter.
\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=2}
\lstinputlisting[label=lst:ISR_ES,caption=ISR - Endschalter]{Code/ISR_Endschalter.txt}
\subsubsection{Watchdog}
Der \Fachbegriff{Watchdog} ist eine Sicherungseinrichtung des Mikrocontroller. In regelmäßigen Abständen wird überprüft ob das Watchdog Bit gesetzt ist und anschließend zurück gesetzt. Das Bit muss innerhalb der voreingestellten Zeit immer wieder neu gesetzt werden. Ist das Bit nicht gesetzt, wird der Mikrocontroller zurückgesetzt. Dies geschieht z.B. bei nicht geplanten Endlosschleifen.\\
Wahlweise kann kurz vor dem Reset noch die Watchdog-ISR durchlaufen werden.\\
Im Projekt wird hier die Fehler LED eingeschaltet und eine Meldung auf dem LC-Display ausgegeben. Siehe hierzu auch das Code-Listing \ref{lst:Watchdog}.
\lstset{language=Java, basicstyle=\footnotesize, showstringspaces=false, tabsize=4}
\lstinputlisting[label=lst:Watchdog,caption=Watchdog]{Code/Watchdog.txt}
\subsection{Protokoll der Schrittmotorkarte}
Tabelle \ref{tbl:ASCII_RS} zeigt den ASCII Befehlssatz der Schrittmotorkarte.
\label{sec:A_ASCII_Befehle}
\begin{table}[htb]
\begin{tabular}{|l|l|}	\hline 
\rule[-1ex]{0pt}{2.5ex} \_A 		& Motorstatus liefern                          \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_C n		& konstante Geschwindigkeit einstellen         \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_D n 		& Bezugswert definieren                        \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_E n		& Motorstrom einstellen                        \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_F 		& Standardeinstellungen aktivieren             \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_H 		& Sanfter stop                                 \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_I 		& 4-Bit-Eingang lesen                          \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_J jdss 	& Joystickparameter einstellen                 \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_L n 		& lokalen Modus aktivieren/beenden             \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_M n 		& n Schritte ausführen                         \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_MA n 		& zu n bewegen                                 \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_MC n 		& mit konstanter Geschwindigkeit bewegen       \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_MCA n 	& MA mit konstanter Geschwindigkeit            \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_MCL n 	& MC zu Endschalterposition                    \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_ML n 		& zur Endschalterposition bewegen              \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_N n 		& Zeilenvorschub (LF, hex. 0A) einfügen/löschen\\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_O n 		& n an 4-Bit-Ausgang senden                    \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_P nnnn 	& Motorparameter einstellen                    \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_Q 		& Parameter in EEROM speichern                 \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_R n 		& Mikroschritteilung einstellen                \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_RL 		& Endschalterwerte lesen                       \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_RS  		& verbleibende Schritte lesen                  \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_S   		& Nothalt                                      \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_T n 		& Eingang n auslösen                           \\ \hline 
\rule[-1ex]{0pt}{2.5ex} \_W   		& Position anfordern                           \\ \hline 
\end{tabular} 
\caption{ASCII Befehlssatz R+S Schrittmotorsteuerung}\cite{rs:ug_stepper}
\label{tbl:ASCII_RS}
\end{table}
 


\subsection{Manueller Betrieb}
\subsection{Protokolle aus RapidForm}
\subsection{Übersetungs Logik}
\subsection{Automatische Protokollwahl}